@{
    ViewData["Title"] = "Registrarte";
}
@{
    <section class="container flex-grow-1">
        <div class="d-flex justify-content-center align-items-center vh-100">
            <div class="shadow p-5 ">
                <div class="d-flex flex-column align-items-center mb-4">
                    <img src="~/assets/img/logo-2.png" class="img-fluid w-25" alt="SmileSoftLogo">
                </div>
                <form class="row">
                    <div class="col-md-6 mb-3">
                    <label class="visually-hidden" for="userFirstNameRegister">Nombres</label>
                        <div class="input-group">
                            <div class="input-group-text">Nombres</div>
                        <input type="text" class="form-control" id="userFirstNameRegister" placeholder="Ingresar Nombre">
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                    <label class="visually-hidden" for="userLastNameRegister">Apellidos</label>
                        <div class="input-group">
                            <div class="input-group-text">Apellidos</div>
                        <input type="text" class="form-control" id="userLastNameRegister"
                                   placeholder="Apellidos">
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                    <label class="visually-hidden" for="tipo_documento">Tipo de Documento</label>
                        <div class="input-group">
                        <div class="input-group-text">Tipo de Documento</div>
                            <select id="tipo_documento" class="form-select" size="1">
                                <option value="TI">Tarjeta de Identidad</option>
                                <option value="CC">Cedula de Ciudadania</option>
                                <option value="CE">Cedula de Extranjeria</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="input-group">
                            <!--<label class="form-outline" for="IdNumber">Numero</label>-->
                            <span class="input-group-text" id="inputGroup-sizing-default">Documento</span>
                            <input type="text" id="IdNumber" class="form-control" />
                        </div>
                    </div>

                @*<div class="col-md-6 mb-3">
                        <div class="input-group">
                            <span class="input-group-text">Fecha de nacimiento</span>
                            <input type="date" id="birthDate" class="form-control " />
                        </div>
                    </div>*@

                    @*<div class="col-md-6 mb-3">
                        <div class="input-group" id="genderOptions">
                            <label class="input-group-text" for="genderSelect">Género</label>
                            <select class="form-select" id="genderSelect">
                                <option selected disabled>Seleccionar</option>
                                <option value="masculino">Masculino</option>
                                <option value="femenino">Femenino</option>
                                <option value="otro">Otro</option>
                            </select>
                        </div>
                    </div>*@

                    <div class="col-md-6 mb-3">
                        <div class=" input-group">
                            <span class="input-group-text">Dirección</span>
                            <input type="text" id="address" class="form-control" />
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="input-group">
                            <span class="input-group-text">Numero de celular</span>
                            <input type="number" id="mobileNumber" class="form-control" />
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                    <div class="input-group ">
                        <span class="input-group-text">Correo electrónico</span>
                        <input type="email" id="email" class="form-control " placeholder="usuario@example.com"/>
                    </div>
                    </div>
                    <div class="col-md-6 mb-3">
                    <div class="input-group ">
                        <span class="input-group-text">Nombre de Usuario</span>
                        <input type="text" id="userNameRegister" class="form-control " placeholder="nombre.apellido" />
                    </div>
                </div>

                    <div class="col-md-6 mb-3">
                        <div class="input-group ">
                            <span class="input-group-text">Contraseña</span>
                            <input type="password" id="password" class="form-control g" placeholder="Password123#" />
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text">Confirmar contraseña</span>
                            <input type="password" id="confirmPassword" class="form-control"
                                   placeholder="Password123#" />
                        </div>
                    </div>

                    <div id="passwordHelpBlock" class="form-text">
                        Tu contraseña debe ser minimo de 8 caracteres, debe contener letras, números o caracteres
                        especiales, y no debe contener espacios o emojis.
                    </div>

                    <div class="text-end mt-4">
                    <button type="button"  class="btn btn-primary d-block btn-user w-100" onclick="registrarUsuario();">
                            <strong>Registrarte</strong>
                        </button>
                    </div>
                </form>
                <hr>
                <div class="text-center"><a class="small" href="@Url.Action("Login","Account")">Ya tienes Cuenta? Inicia Sesión!</a></div>
                <div class="form-check" style="display:none"><input class="form-check-input custom-control-input" type="checkbox" id="remember_me"><label class="form-check-label custom-control-label" for="remember_me">Recordarme</label></div>

            </div>
        </div>
    </section>



@section Scripts {
    <script>

        function validarContraseña(password) {
            if (password.length < 8) {
                return false;
            }

            if (!/[a-zA-Z]/.test(password)) {
                return false;
            }

            if (!/\d/.test(password)) {
                return false;
            }


            if (/\s/.test(password) || /[\uD800-\uDFFF]/.test(password)) {
                return false;
            }

           
            return true;
        }
        function registrarUsuario(){
            let firstName = document.getElementById("userFirstNameRegister").value.trim();
            let lastName = document.getElementById("userLastNameRegister").value.trim();
            let documentID = document.getElementById("IdNumber").value.trim();
            let address = document.getElementById("address").value.trim();
            let mobileNumber = document.getElementById("mobileNumber").value.trim();
            let email = document.getElementById("email").value.trim();
            let userRegister = document.getElementById("userNameRegister").value.trim();
            let password = document.getElementById("password").value.trim();
            let confirmPassword = document.getElementById("confirmPassword").value.trim();
          

            if (firstName === "" || lastName === "") {
                Swal.fire({
                    text: 'Por favor, ingrese su nombre completo.',
                    confirmButtonColor: '#008dc9'
                });
            }
            else if (documentID === "") {
                Swal.fire({
                    text: 'Por favor, ingrese su número de documento.',
                    confirmButtonColor: '#008dc9'
                });
            }
            else if (address === "") {
                Swal.fire({
                    text: 'Por favor, ingrese su dirección.',
                    confirmButtonColor: '#008dc9'
                });
            }
            else if (mobileNumber === "") {
                Swal.fire({
                    text: 'Por favor, ingrese su número de celular o telefono.',
                    confirmButtonColor: '#008dc9'
                });
            } else if (email === "") {
                Swal.fire({
                    text: 'Por favor, ingrese su correo electrónico.',
                    confirmButtonColor: '#008dc9'
                });
            } else if (userRegister === "") {
                Swal.fire({
                    text: 'Por favor, ingrese su usuario.',
                    confirmButtonColor: '#008dc9'
                });
            } else if (password === "") {
                Swal.fire({
                    text: 'Por favor, ingrese su contraseña.',
                    confirmButtonColor: '#008dc9'
                });
            } else if (confirmPassword === "") {
                Swal.fire({
                    text: 'Por favor, ingrese la confirmación de su contraseña.',
                    confirmButtonColor: '#008dc9'
                });
            } else if (!validarContraseña(password)) {
                Swal.fire({
                    text: 'La contraseña no cumple con los requisitos.',
                    confirmButtonColor: '#008dc9'
                });
            } else if (confirmPassword != password) {
                Swal.fire({
                    text: 'Las contraseñas no coinciden.',
                    confirmButtonColor: '#008dc9'
                });
            } else {
                let data = {
                    uID: 0,
                    utID: 3,
                    uName: firstName,
                    ulastName: lastName,
                    uDocument: documentID,
                    uAddress: address,
                    uCellphone: mobileNumber,
                    uEmailAddress: email,
                    uLoginName: userRegister,
                    uPassword: password,
                    dtID: 1,
                    uStatus: 1,
                    uIsBLocked: 0
                };
                $.ajax({
                    type: 'POST',
                    url: '@ViewBag.urlEndPoint' + '/api/Users/v1/CreateUpdateUsers', // Ruta para crear o actualizar usuarios
                    data: JSON.stringify(data),
                    contentType: 'application/json',
                    success: function (response) {
                        console.log(response.OutputCodeError);
                        if (response.codeStatus === '0') {
                            // Registro exitoso, puedes redirigir al usuario o mostrar un mensaje de éxito
                            //alert('Usuario registrado con éxito.');
                            Swal.fire({
                                icon: 'success',
                                title: 'Usuario Registrado',
                                text: 'Usuario registrado con éxito.',
                                confirmButtonColor: '#008dc9',
                                allowOutsideClick: false,
                                allowEscapeKey: false,
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.href = '@Url.Action("Login", "Account")';
                                }
                            });
                        } else if (response.codeStatus === '-1') {
                            // El usuario ya existe en la base de datos
                            //alert('Este usuario ya existe en la base de datos.');
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: 'Este usuario ya existe en la base de datos.',
                                confirmButtonColor: '#008dc9'
                            })
                        } else {
                            // Manejar otros códigos de error si es necesario
                            alert('Error: ' + response.OutputMessageError);
                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: 'Error: ' + response.OutputMessageError,
                                confirmButtonColor: '#008dc9'
                            })
                        }
                    },
                    error: function (error) {
                        // Manejar errores de la solicitud AJAX
                        console.error('Error al registrar usuario:', error);
                    }
                });
            }

        }
    </script>
}
    



@* <script>
    document.getElementById('registerButton').addEventListener('click', function (event) {
        event.preventDefault(); // Evita la recarga de la página

        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'Aun estamos Trabajando!',
            confirmButtonColor: '#008dc9'
        })
    });
</script> *@

    @*<script src="~/assets/js/bs-init.js" asp-append-version="true"></script>*@
@* <script src="~/assets/js/Register.js" asp-append-version="true"></script> *@
}